# Gemini Agent Instructions for RadarDocGenerator

This document provides context and instructions for an AI agent maintaining this project.

## 1. Project Overview

- **Goal:** Automatically generate Microsoft Word (`.docx`) reports from radar image data located in "Policy" folders.
- **Core Script:** `baseline.py`
- **Process:** The script reads data, processes images, and populates a Word template (`templates/baseline.docx`).

## 2. Tech Stack

- **Language:** Python 3
- **Key Libraries:**
    - `python-docx`: Word document manipulation.
    - `Pillow`: Image processing (resizing, format conversion).
- **Environment:** `conda`. See `environment.yml`.

## 3. Environment and Execution

**Objective:** To run the report generation script.

1.  **Ensure Conda Environment is Active:** The environment is named `radardoc`. If not active, run:
    ```bash
    conda activate radardoc
    ```
2.  **Execution Command:** The main script `baseline.py` takes one argument: the path to the parent directory containing the `Policy*` folders.
    ```bash
    python baseline.py "D:\path\to\Policies-ALOS"
    ```
3.  **Batch File:** The `baseline.bat` script automates this process by prompting the user for the path.

## 4. Core Logic Patterns

### Dynamic Image Layout (`_get_layout_params`)

- **Location:** `baseline.py`, within the `Policy` class.
- **Purpose:** To determine the optimal number of columns and cell dimensions for the image table.
- **Algorithm:**
    1.  Iterates through column counts from 3 to 7.
    2.  Calculates two metrics for each layout:
        - `aspect_ratio_diff`: The difference between the image's aspect ratio and the resulting table cell's aspect ratio. (Lower is better).
        - `fullness_score`: How full the last row is (1.0 = completely full). (Higher is better).
    3.  **Decision Logic:**
        - It creates a list of "good" layouts where `fullness_score > 0.5`.
        - If this list is not empty, it sorts it by `aspect_ratio_diff` (ascending) and then by `fullness_score` (descending) to find the best option.
        - If the list is empty, it falls back to choosing the layout with the minimum `aspect_ratio_diff` from all possibilities.

## 5. Common Maintenance Tasks

### Task: Modify the report's visual template (fonts, headers, static text)

- **Action:** Directly edit the template file: `templates/baseline.docx`.

### Task: Change the image layout rules

- **Action:** Modify the `_get_layout_params` function in `baseline.py`. The logic is described in section 4.

### Task: Add a new data field to the main table

- **Action:** Modify the `fill_image_metadata` function in `baseline.py`. This function is responsible for populating the main data table.

### Task: Fix image processing issues (e.g., errors during resize)

- **Action:** Investigate the `_resize_and_save_image` function in `baseline.py`. This function handles opening, resizing, and saving images.
